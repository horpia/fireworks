<!DOCTYPE html>
<html lang="en">
<head>
    <title>Fireworks</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<script src="index.js"></script>
<script>
	function showFireworksNy21() {
		const tpl = document.createElement('template');
		tpl.innerHTML = `
			<div>
				<fw-canvas id="fw1"
					fullscreen
					sounds-url="http://cs.pikabu.ru/images/fun/newyear2021/sounds"
					bg-image="http://cs.pikabu.ru/images/fun/newyear2021/bg/snow-city-bg.png"></fw-canvas>
				<div data-role="close" style="position: fixed; top: 30px; right: 30px; z-index: 2000000; cursor: pointer">
					<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
						viewBox="0 0 640 640" width="26" height="26">
						<defs><path d="M625.32 512.46C630.14 517.37 630.06 525.26 625.15 530.08C603.21 551.61
						546.28 607.49 524.34 629.02C519.43 633.84 511.54 633.77 506.73 628.86C406.57 526.82 114.84
						229.58 14.68 127.54C9.86 122.63 9.94 114.74 14.85 109.92C36.79 88.39 93.72 32.51 115.66
						10.98C120.57 6.16 128.46 6.23 133.27 11.14C233.43 113.18 525.16 410.42 625.32 512.46Z"
						id="e2H2zGrXcG"></path>
						<path d="M17.42 512.46C12.6 517.37 12.68 525.26 17.59 530.08C39.53 551.61 96.46 607.49
						118.4 629.02C123.31 633.84 131.2 633.77 136.02 628.86C236.17 526.82 527.91 229.58 628.06
						127.54C632.88 122.63 632.81 114.74 627.9 109.92C605.96 88.39 549.02 32.51 527.08 10.98C522.17
						6.16 514.29 6.23 509.47 11.14C409.31 113.18 117.58 410.42 17.42 512.46Z" id="cKMf8sFAJ"></path>
						</defs>
						<use xlink:href="#e2H2zGrXcG" opacity="1" fill="#b1bece" fill-opacity="1"></use>
						<use xlink:href="#cKMf8sFAJ" opacity="1" fill="#b1bece" fill-opacity="1"></use>
					</svg>
				</div>
			</div>
		`;
		const el = tpl.content.firstElementChild.cloneNode(true);
		document.body.appendChild(el);

		el.querySelector('div[data-role="close"]').onclick = () => {
			document.body.removeChild(el);
		};

		const fireworks = new Set();
		const fw = document.getElementById('fw1');

		generateFireworks();

		function generateFireworks() {
			const xStep = 50;
			const xStep2 = xStep / 2;
			const y = fw.canvasBack.height - 90;
			const count = Math.floor(fw.canvasBack.width / xStep) - 1;
			if (fireworks.size >= count) {
				return;
			}

			for (let i = 0; i < count; i++) {
				createFirework(xStep2 + i * xStep, y, xStep);
			}
		}

		function createFirework(x, y, xStep) {
			const slotAreaHeight = 60;
			const firework = fw.getRandomFirework({
				x: x + Math.ceil(Math.random() * xStep),
				y: y + Math.ceil(Math.random() * slotAreaHeight),
			}, false);

			fw.addFirework(firework).then(() => {
				fireworks.delete(firework);
				if (fireworks.size === 0) {
					generateFireworks();
				}
			});

			fireworks.add(firework);
		}
	}
	showFireworksNy21();
</script>
</body>
</html>