(()=>{"use strict";class t extends HTMLElement{constructor(){super(),this.checkedAttributes=new Map}static get observedAttributes(){return[]}createShadowDom(t="",e=""){this.attachShadow({mode:"open"}),""!==t&&(t=`<style>${t}</style>`),this.shadowRoot.innerHTML=`${t}${e}`}handleAttributesChange(){}attributeChangedCallback(t,e,i){let s="";this.checkedAttributes.has(t)?s=this.checkedAttributes.get(t):(s="handle"+t.split("-").map((t=>t.substr(0,1).toUpperCase()+t.substr(1))).join("")+"Change",s in this||(s=""),this.checkedAttributes.set(t,s)),""!==s&&this[s](),this.handleAttributesChange()}}class e{constructor(t,e){this.nextRenderId=0,this.started=!1,this.nextFrameTime=0,this.needRender=!1,this.bgImage=null,this.bgColor="",this.globalOpacity=0,this.glowTime=0,this.renderList=t,this.context=e,this.requestNextRender=window.requestAnimationFrame,this.renderCallback=this.render.bind(this),this.renderObservers=new Set,this.nextRenderHandlers=new Set}get canvas(){return this.context.canvas}get backgroundColor(){return this.bgColor}set backgroundColor(t){this.bgColor=t,this.requestRender()}setBackgroundImage(t){return""===t?(this.bgImage=null,this.requestRender(),Promise.resolve()):new Promise((e=>{const i=new Image;i.addEventListener("load",(()=>{this.bgImage=i,this.requestRender(),e()})),i.crossOrigin="anonymous",i.src=t}))}useGlowTail(){if(this.glowCanvas)return;const t=this.context.canvas;this.glowCanvas=document.createElement("canvas"),this.glowCanvas.width=t.width,this.glowCanvas.height=t.height,this.glowCanvasContext=this.glowCanvas.getContext("2d")}start(){return this.started&&this.finish(),this.glowTime=0,this.globalOpacity=0,this.started=!0,this.render(),this}finish(){return this.started=!1,window.cancelAnimationFrame(this.nextRenderId),this}observe(t){this.renderObservers.add(t)}requestRender(t=null){this.needRender=!0,null!==t&&this.nextRenderHandlers.add(t)}render(){const t=Date.now();if(this.nextRenderId=this.requestNextRender.call(window,this.renderCallback),t<this.nextFrameTime)return;this.nextFrameTime=t+41,this.renderList.interrupt(),this.nextRenderHandlers.size>0&&(this.nextRenderHandlers.forEach((t=>t())),this.nextRenderHandlers.clear());const e=this.context.canvas;!this.renderList.needRender&&!this.needRender&&this.globalOpacity>=1&&0===this.glowTime||(this.globalOpacity<1&&(this.globalOpacity+=.1),this.prepareCanvasBeforeRender(),(this.renderList.needRender||this.needRender)&&this.glowCanvas&&(this.glowTime=5),this.context.globalAlpha=this.globalOpacity,this.bgColor&&(this.context.fillStyle=this.bgColor,this.context.fillRect(0,0,e.width,e.height)),this.drawBgImage(),this.needRender=!1,this.renderList.render(this.context),this.renderObservers.size>0&&this.renderObservers.forEach((t=>t())))}prepareCanvasBeforeRender(){const t=this.context.canvas;this.glowCanvasContext&&this.glowTime>1?(this.glowCanvas.width===t.width&&this.glowCanvas.height===t.height||(this.glowCanvas.width=t.width,this.glowCanvas.height=t.height),this.glowCanvasContext.clearRect(0,0,t.width,t.height),this.glowCanvasContext.drawImage(t,0,0),this.context.clearRect(0,0,t.width,t.height),this.context.globalAlpha=.5,this.context.drawImage(this.glowCanvas,0,0),this.context.globalAlpha=1,this.glowTime--):this.context.clearRect(0,0,t.width,t.height)}drawBgImage(){if(!this.bgImage||!this.bgImage.complete||0===this.bgImage.naturalWidth)return;const t=this.bgImage.naturalWidth,e=this.canvas.height-this.bgImage.naturalHeight,i=Math.ceil(this.canvas.width/t);for(let s=0;s<i;s++)this.context.drawImage(this.bgImage,s*t,e)}}class i{constructor(){this.isChangedByInterruption=!1,this.isChangedList=!1,this.list=new Set,this.waitList=new Set,this.beforeRenderCallbacks=new WeakMap,this.afterRenderCallbacks=new WeakMap}clear(){this.list.clear(),this.waitList.clear(),this.isChangedList=!0}add(t,e=0,i=null,s=null){return e>0?this.waitList.add({element:t,wait:e}):this.list.add(t),"function"==typeof i&&this.beforeRenderCallbacks.set(t,i),"function"==typeof s&&this.afterRenderCallbacks.set(t,s),this.isChangedList=!0,this}remove(t){for(const e of this.waitList)if(e.element===t){this.waitList.delete(e);break}return this.list.delete(t),this.isChangedList=!0,this}getBoundingRect(){const t={x:Number.MAX_VALUE,y:Number.MAX_VALUE},e={x:0,y:0};for(const i of this.list){const{x:s,y:n,width:h,height:o}=i.getBoundingRect();t.x=Math.min(t.x,s),t.y=Math.min(t.y,n),e.x=Math.max(e.x,s+h),e.y=Math.max(e.y,n+o)}return{x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y}}getElementUnderPoint(t){for(const e of[...this.list].reverse()){const{x:i,y:s,width:n,height:h}=e.getBoundingRect();if(t.x>i&&t.x<i+n&&t.y>s&&t.y<s+h)return e}return null}get isEnded(){return!(this.waitList.size>0)&&(0===this.list.size||[...this.list].every((t=>t.isEnded)))}get needRender(){return this.isChangedByInterruption||this.isChangedList}interrupt(){let t=!1;for(const e of this.list)e.isEnded?(this.list.delete(e),t=!0):e.interrupt()&&(t=!0);for(const e of this.waitList)0==--e.wait&&(this.waitList.delete(e),this.list.add(e.element),t=!0);return this.isChangedByInterruption=t,t}render(t){this.isChangedList=!1,this.isChangedByInterruption=!1;for(const e of this.list)this.beforeRenderCallbacks.has(e)&&(t.save(),this.beforeRenderCallbacks.get(e)(t),t.restore()),t.save(),e.render(t),t.restore(),this.afterRenderCallbacks.has(e)&&(t.save(),this.afterRenderCallbacks.get(e)(t),t.restore())}}const s=Math.PI/180,n=180/Math.PI,h=2*Math.PI,o=Math.PI/2;function a(t,e=1,i=0){return Math.max(i,Math.max(i,t))}function r(t,e=0,i){return e+t*(i-e)}function l(t=1e3){return Math.round(Math.random()*t)/t}function d(t,e=0){return e+Math.random()*(t-e)}function c(t,e,i,s){const n=1-t,h=n**2,o=t**2;return{x:h*e.x+2*n*t*i.x+o*s.x,y:h*e.y+2*n*t*i.y+o*s.y}}const u=new Map;var g;!function(t){t.LAUNCH_1="launch-1.mp3",t.EXPLOSION_1="explosion-1.mp3",t.EXPLOSION_2="explosion-2.mp3",t.EXPLOSION_FIZZ="explosion-fizz.mp3"}(g||(g={}));let f=.3,p=!1;class w{constructor(t){this.fileName=t,this.wasPlayed=!1,this.canPlay=!0,this.isLoading=!1,this.filePath=w.assetsUrl+"/"+this.fileName,u.has(this.filePath)&&(this.audio=u.get(this.filePath).cloneNode(!0),this.audio.volume=f)}static get disabled(){return p}static set disabled(t){p=t}static muteAll(t){f=t?0:.3}play(){return!(!p&&!this.wasPlayed&&this.canPlay&&(this.isLoading||this.playWhenReady().then(),1))}preloadFile(){if(u.has(this.filePath))return;const t=new Audio;t.volume=f,t.autoplay=!1,t.src=this.filePath,u.set(this.filePath,t)}async playWhenReady(){p||(this.isLoading=!0,u.has(this.filePath)||this.preloadFile(),this.audio||(this.audio=u.get(this.filePath).cloneNode(!0)),this.audio.volume=f,this.wasPlayed=!0,await this.audio.play(),this.isLoading=!1)}}w.assetsUrl="./sounds";const m=["#ff5b5b","#ffd449","#c4ff21","#21ff60","#21f8ff","#41b4ff","#d466ff","#ff66c2","#ffffe7"],M="#fff",E=["#a95e47","#bca047","#819d4a","#7ed070","#73bbc8","#8a8bf5","#ab80bc","#ec2f8d","#acaca3"];function y(t,e=m){const i=[...e];t=Math.min(t,i.length);const s=[];for(;t-- >0;)s.push(i.splice(Math.round(1e3*Math.random())%i.length,1)[0]);return s}var v;!function(t){t[t.MIN_PEAKS=9]="MIN_PEAKS",t[t.MAX_PEAKS=15]="MAX_PEAKS",t[t.MIN_DISTANCE=20]="MIN_DISTANCE",t[t.MAX_DISTANCE=40]="MAX_DISTANCE"}(v||(v={}));class S{constructor(t){var e,i;this.sound=null,this.stage=0,this.opacity=1,this.angleStepDeg=0,this.glowRadius1=5,this.glowRadius2=10,this.pos=t.position||{x:0,y:0},this.color=(null==t?void 0:t.colors[0])||M,this.distance=r(null!==(e=t.sizeFactor)&&void 0!==e?e:.5,v.MIN_DISTANCE,v.MAX_DISTANCE),this.angleStepDeg=360/(2*r(null!==(i=t.elementsFactor)&&void 0!==i?i:.5,v.MIN_PEAKS,v.MAX_PEAKS)),t.noSound||(this.sound=new w(g.EXPLOSION_1))}getBoundingRect(){const t=this.distance>>1;return{x:this.pos.x-t,y:this.pos.y-t,width:this.distance,height:this.distance}}get isEnded(){return this.stage>=3}interrupt(){var t;if(!1===(null===(t=this.sound)||void 0===t?void 0:t.play()))return!1;switch(this.stage){case 0:this.pathGlow=this.generatePath(1,180*Math.random()),this.pathLight=this.generatePath(.5,180*Math.random()),this.glowRadius1=.3*this.distance,this.glowRadius2=.7*this.distance;break;case 1:this.pathGlow=this.generatePath(2,180*Math.random()),this.pathLight=this.generatePath(1,180*Math.random()),this.glowRadius1=.5*this.distance,this.glowRadius2=1.2*this.distance;break;case 2:this.pathGlow=null,this.pathLight=this.generatePath(.5,180*Math.random()),this.glowRadius1=this.distance,this.glowRadius2=2*this.distance,this.opacity=.4}return++this.stage,!0}render(t){if(t.translate(this.pos.x,this.pos.y),this.glowRadius2>0){const e=t.createRadialGradient(0,0,this.glowRadius1,0,0,this.glowRadius2);e.addColorStop(0,"rgba(255, 255, 255, 0.3)"),e.addColorStop(1,"rgba(255, 255, 255, 0)"),t.globalAlpha=this.opacity,t.fillStyle=e,t.fillRect(-this.glowRadius2,-this.glowRadius2,this.glowRadius2<<1,this.glowRadius2<<1)}this.pathGlow&&(t.fillStyle=this.color,t.globalAlpha=.7*this.opacity,S.drawPath(this.pathGlow,t)),this.pathLight&&(t.fillStyle="#ffffff",t.globalAlpha=this.opacity,S.drawPath(this.pathLight,t))}static drawPath(t,e){e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++)e.lineTo(t[i].x,t[i].y);e.closePath(),e.fill()}generatePath(t,e=0){const i=this.distance*t,n=.3*i,h=Math.floor(360/this.angleStepDeg),o=[];for(let t=0;t<h;t++){let h=e+this.angleStepDeg*t;h+=this.angleStepDeg*(.3*Math.random()-.3),h*=s;let a=1==(1&t)?n:i;a*=.4+.6*Math.random(),o.push({x:a*Math.cos(h),y:a*Math.sin(h)})}return o}}const x=.05;class A{constructor(t=20,e=2){this.length=t,this.pointSize=e,this.points=[],this.halfSize=e/2,this.opacityStep=1/t}addPoint(t){if(0===this.points.length)return this.points.push({...t,opacity:1}),this;const e=this.points[0],i=t.x-e.x,s=t.y-e.y,n=Math.ceil(Math.max(Math.abs(i),Math.abs(s))/this.pointSize);if(n<=1)return this.points.unshift({...t,opacity:1}),this;const h=i/n,o=s/n,a=(1-e.opacity)/n;for(let t=1;t<=n;t++)this.points.unshift({x:e.x+h*t,y:e.y+o*t,opacity:e.opacity+a*t});return this}getBoundingRect(){const t={x:Number.MAX_VALUE,y:Number.MAX_VALUE},e={x:0,y:0};for(const i of this.points)t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),e.x=Math.max(e.x,i.x),e.y=Math.max(e.y,i.y);return{x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y}}get isEnded(){for(const t of this.points)if(t.opacity>x)return!1;return!0}interrupt(){this.points.length>300&&this.points.splice(200);for(const t of this.points){if(t.opacity<=x)break;t.opacity/=2}return!0}render(t){let e=1;for(let i=0;i<this.points.length&&i<this.length;i++){const s=this.points[i];if(s.opacity<=x)break;t.globalAlpha=e>s.opacity?s.opacity:e,t.fillRect(s.x-this.halfSize,s.y-this.halfSize,this.pointSize,this.pointSize),e-=this.opacityStep}}}class b{constructor(t,e,i){var s,n;this.distance=e,this.sound=null,this.time=0,this.value=0,this.duration=0,this.opacity=1,this.elements=[],this.colors=t.colors||[M],this.pos={...t.position||{x:0,y:0}},this.elements=this.generateElements(i),this.explosionType0=new S({colors:[this.colors[0]],position:this.pos,sizeFactor:null!==(s=t.sizeFactor)&&void 0!==s?s:.5,elementsFactor:null!==(n=t.elementsFactor)&&void 0!==n?n:.5,noSound:!0}),t.noSound||(this.sound=new w(g.EXPLOSION_2))}getRandomColor(){return this.colors[Math.ceil(1e3*Math.random())%this.colors.length]}getBoundingRect(){const t=this.distance>>1;return{x:this.pos.x-t,y:this.pos.y-t,width:this.distance,height:this.distance}}get isEnded(){var t,e;if(this.time<this.duration)return!1;for(const e of this.elements)if(!1===(null===(t=e.tail)||void 0===t?void 0:t.isEnded))return!1;return!1!==(null===(e=this.explosionType0)||void 0===e?void 0:e.isEnded)}interrupt(){var t,e,i,s;if(!1===(null===(t=this.sound)||void 0===t?void 0:t.play()))return!1;for(const t of this.elements)null===(e=t.tail)||void 0===e||e.interrupt();if(this.explosionType0&&(this.explosionType0.isEnded?this.explosionType0=null:this.explosionType0.interrupt()),this.time>=this.duration)return!0;this.value=1===(s=Math.min(1,this.time/this.duration))?1:1-Math.pow(2,-10*s);const n=1*this.time;for(const t of this.elements){const e=this.value*t.distance;t.x=t.xFactor*e+t.xFactor*n,t.y=t.yFactor*e+n,null===(i=t.tail)||void 0===i||i.addPoint({x:t.x,y:t.y})}return this.time>=this.duration-10&&(this.opacity=(this.duration-this.time)/10),++this.time,!0}render(t){var e;if(t.save(),t.translate(this.pos.x,this.pos.y),this.time<this.duration){t.globalAlpha=.3*this.opacity;for(const e of this.elements)t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,6,0,h),t.fill()}for(const i of this.elements)t.fillStyle=i.color,null===(e=i.tail)||void 0===e||e.render(t);if(this.time<this.duration){t.globalAlpha=this.opacity,t.fillStyle="#fff";for(const e of this.elements)t.fillRect(e.x-1,e.y-1,2,2)}t.restore(),this.explosionType0&&this.explosionType0.render(t)}}var C;!function(t){t[t.MIN_ELEMENTS=10]="MIN_ELEMENTS",t[t.MAX_ELEMENTS=50]="MAX_ELEMENTS",t[t.MIN_DISTANCE=100]="MIN_DISTANCE",t[t.MAX_DISTANCE=300]="MAX_DISTANCE"}(C||(C={}));class I extends b{constructor(t){var e,i;super(t,r(null!==(e=t.sizeFactor)&&void 0!==e?e:.5,C.MIN_DISTANCE,C.MAX_DISTANCE),r(null!==(i=t.elementsFactor)&&void 0!==i?i:.5,C.MIN_ELEMENTS,C.MAX_ELEMENTS)),this.duration=15}generateElements(t){let e=0;const i=360/t,n=[];for(let h=0;h<t;h++)e=i*h,e+=i*(.4*Math.random()*2-.4),e*=s,n.push({distance:this.distance*(.5+.5*Math.random()),xFactor:Math.cos(e),yFactor:Math.sin(e),tail:new A(30,2).addPoint({x:0,y:0}),color:this.getRandomColor(),x:0,y:0});return n}}var N,k,F;!function(t){t[t.MIN_ELEMENTS=15]="MIN_ELEMENTS",t[t.MAX_ELEMENTS=30]="MAX_ELEMENTS",t[t.MIN_DISTANCE=130]="MIN_DISTANCE",t[t.MAX_DISTANCE=300]="MAX_DISTANCE"}(N||(N={}));class L extends b{constructor(t){var e,i;super(t,r(null!==(e=t.sizeFactor)&&void 0!==e?e:.5,N.MIN_DISTANCE,N.MAX_DISTANCE),r(null!==(i=t.elementsFactor)&&void 0!==i?i:.5,N.MIN_ELEMENTS,N.MAX_ELEMENTS)),this.duration=20}generateElements(t){const e=[],i=Math.PI/t;let s=0;for(let n=0;n<t;n++){const h=i*n,o=Math.cos(h),a=Math.sin(h),r=Math.max(1,Math.ceil(t*a)),l=Math.PI/r;for(let t=0;t<r;t++){let i=a*Math.cos(l*t);i+=.02*Math.random()*2-.02;const n=o+(.02*Math.random()*2-.02),h=++s%3==0;e.push({x:0,y:0,distance:this.distance*(.05*Math.random()*2-.05+1),xFactor:i,yFactor:n,color:this.getRandomColor(),tail:h?new A(9,2).addPoint({x:0,y:0}):null})}}return e}}!function(t){t[t.MIN_ELEMENTS=30]="MIN_ELEMENTS",t[t.MAX_ELEMENTS=60]="MAX_ELEMENTS",t[t.MIN_DISTANCE=200]="MIN_DISTANCE",t[t.MAX_DISTANCE=300]="MAX_DISTANCE"}(k||(k={}));class R extends b{constructor(t){var e,i;super(t,r(null!==(e=t.sizeFactor)&&void 0!==e?e:.5,k.MIN_DISTANCE,k.MAX_DISTANCE),r(null!==(i=t.elementsFactor)&&void 0!==i?i:.5,k.MIN_ELEMENTS,k.MAX_ELEMENTS)),this.duration=15}generateElements(t){let e=0;const i=360/t,n=[],o=Math.random()*h,a=Math.cos(o),r=Math.sin(o);for(let h=0;h<t;h++){e=i*h,e+=i*(.1*Math.random()*2-.1),e*=s;let t=Math.cos(e),o=Math.sin(e)/5;n.push({distance:this.distance,xFactor:t*a-o*r,yFactor:t*r+o*a,tail:new A(6,2).addPoint({x:0,y:0}),color:this.getRandomColor(),x:0,y:0})}return n}}!function(t){t[t.MIN_ELEMENTS=15]="MIN_ELEMENTS",t[t.MAX_ELEMENTS=50]="MAX_ELEMENTS",t[t.MIN_DISTANCE=100]="MIN_DISTANCE",t[t.MAX_DISTANCE=300]="MAX_DISTANCE"}(F||(F={}));class T{constructor(t){var e,i;this.time=0,this.points=[],this.pos=t.position||{x:0,y:0},this.color=t.colors[0]||M,this.elementsCount=r(null!==(e=t.elementsFactor)&&void 0!==e?e:.5,F.MIN_ELEMENTS,F.MAX_ELEMENTS),this.distance=r(null!==(i=t.sizeFactor)&&void 0!==i?i:.5,F.MIN_DISTANCE,F.MAX_DISTANCE)}getBoundingRect(){const t=this.distance>>1;return{x:this.pos.x-t,y:this.pos.y-t,width:this.distance,height:this.distance}}get isEnded(){return this.elementsCount<=0}interrupt(){this.points=[];for(let t=0;t<this.elementsCount;t++){const t=Math.random()*h,e=Math.random()*this.distance;this.points.push({x:Math.cos(t)*e,y:Math.sin(t)*e})}return this.pos.y+=2,this.elementsCount-=2,!0}render(t){t.translate(this.pos.x,this.pos.y),t.globalAlpha=.5,t.fillStyle=this.color;for(const e of this.points)t.fillRect(e.x-1,e.y-4,2,8),t.fillRect(e.x-4,e.y-1,8,2);t.fillStyle="#fff",t.globalAlpha=1;for(const e of this.points)t.fillRect(e.x-1,e.y-1,2,2)}}const P=Math.ceil(12),_="#fff8df";var B;!function(t){t[t.WAIT=0]="WAIT",t[t.INCREASE_SPARK=1]="INCREASE_SPARK",t[t.LAUNCH=2]="LAUNCH",t[t.EXPLOSION=3]="EXPLOSION"}(B||(B={}));class X{constructor(t,e=null,i=0,s=4,n=10,h=15){this.canvas=e,this.angle=i,this.width=s,this.height=n,this.duration=h,this.sparks=[],this.time=0,this.stage=B.WAIT,this.sparkValue=0,this.prevValue=0,this.opacity=1,this.canBeLaunched=!0,this.pos=t.position||{x:0,y:0},this.fromPos={...this.pos},this.widthHalf=this.width/2,this.widthQuarter=this.width/4,this.heightHalf=this.height/2,this.heightQuarter=this.height/4,this.tail=new A(60,2),this.generateFinalPos(),this.generateAnchorPos(),"function"==typeof t.onLaunch&&(this.launchCallback=t.onLaunch),!1===t.canBeLaunched&&(this.canBeLaunched=!1),!0===t.autoLaunch&&this.launch(),!0===t.rocketFading&&(this.opacity=0)}getBoundingRect(){return{x:this.pos.x-(this.width<<1),y:this.pos.y-(this.height<<1),width:this.width<<2,height:this.height<<2}}get isEnded(){return this.stage===B.EXPLOSION&&this.tail.isEnded}launch(){return this.canBeLaunched?(this.stage===B.WAIT&&(this.stage=B.INCREASE_SPARK),this.launchCallback&&this.launchCallback(),this):this}interrupt(){var t;return this.opacity<1&&(this.opacity=Math.min(1,this.opacity+.1)),this.stage===B.WAIT?this.opacity<1:!1!==(null===(t=this.sound)||void 0===t?void 0:t.play())&&(this.stage!==B.INCREASE_SPARK&&this.tail.interrupt(),this.moveRocket(),this.generateSparks(),!0)}render(t){this.stage>B.INCREASE_SPARK&&(t.save(),t.fillStyle=_,this.tail.render(t),t.restore()),this.stage!==B.EXPLOSION&&(t.translate(this.pos.x,this.pos.y),t.globalAlpha=this.opacity,t.rotate(this.angle*s),this.drawRocket(t),this.stage===B.INCREASE_SPARK&&(this.sparkValue+=.1,this.sparkValue>=1&&(this.sparkValue=1,this.stage=B.LAUNCH)),this.stage>B.WAIT&&this.drawSparks(t),this.drawWings(t))}moveRocket(){if(this.stage!==B.LAUNCH)return;if(++this.time,this.time>this.duration)return this.stage=B.EXPLOSION,void(this.finishCallback&&this.finishCallback(this.pos));let t=this.time/this.duration;var e;if(t=(e=t)*e*e,t>.2)for(let e=this.prevValue;e<t;e+=.05)this.tail.addPoint(c(e,this.fromPos,this.anchorPos,this.toPos));this.prevValue=t;const i=c(t,this.fromPos,this.anchorPos,this.toPos);var s,h;this.angle=(s=i,h=this.pos,-Math.atan2(h.x-s.x,h.y-s.y)*n),this.pos=i}generateSparks(){if([B.INCREASE_SPARK,B.LAUNCH].includes(this.stage)){this.sparks=[];for(let t=0;t<20;t++){const t=o+15*(2*Math.random()-1)*s;let e=4+.5*Math.random()*4;e*=this.sparkValue;let i=30*Math.random();i*=this.sparkValue;const n=Math.cos(t),h=Math.sin(t),a=-this.widthHalf+Math.random()*this.width;this.sparks.push({x1:i*n+a,y1:i*h,x2:(i+e)*n+a,y2:(i+e)*h})}}}drawSparks(t){this.sparkGradient||(this.sparkGradient=t.createLinearGradient(-this.widthHalf+this.widthQuarter,0,this.width-this.widthHalf,12),this.sparkGradient.addColorStop(0,_),this.sparkGradient.addColorStop(.2,"rgba(255, 248, 223, 0.8)"),this.sparkGradient.addColorStop(1,"rgba(255, 248, 223, 0)")),t.fillStyle=this.sparkGradient,t.fillRect(-this.widthHalf+this.widthQuarter,0,this.width-this.widthHalf,12*this.sparkValue),t.strokeStyle=_,t.beginPath();for(const e of this.sparks)t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2);t.stroke()}generateAnchorPos(){const t=o+this.angle*s,e=Math.max(200,Math.min(400,200-this.fromPos.y));this.anchorPos={x:this.fromPos.x-Math.cos(t)*e,y:this.fromPos.y-Math.sin(t)*e}}generateFinalPos(){if(!this.canvas)return void(this.toPos={x:0,y:0});const t=Math.max(100,this.fromPos.x-300),e=Math.min(this.canvas.width-100,this.fromPos.x+300),i=Math.min(300,this.canvas.height-100);this.toPos={x:t+Math.round(Math.random()*(e-t)),y:200+Math.round(Math.random()*(i-200))}}}const z="#0e0e0e";var H;!function(t){t[t.MIN_ANGLE=-45]="MIN_ANGLE",t[t.MAX_ANGLE=45]="MAX_ANGLE",t[t.MIN_SIZE=1]="MIN_SIZE",t[t.MAX_SIZE=1.5]="MAX_SIZE"}(H||(H={}));const O="#404040";var D,Q,G,q;!function(t){t[t.MIN_ANGLE=-45]="MIN_ANGLE",t[t.MAX_ANGLE=45]="MAX_ANGLE",t[t.MIN_SIZE=1]="MIN_SIZE",t[t.MAX_SIZE=1.3]="MAX_SIZE"}(D||(D={})),function(t){t.TYPE0="type0",t.TYPE1_CIRCLE="type1-circle",t.TYPE1_SPHERE="type1-sphere",t.TYPE1_DISK="type1-disk",t.TYPE2="type2"}(Q||(Q={})),function(t){t.COMB1="comb1",t.COMB2="comb2",t.COMB3="comb3",t.COMB4="comb4",t.COMB5="comb5",t.COMB6="comb6"}(G||(G={})),function(t){t.TYPE0="type0",t.TYPE1="type1"}(q||(q={}));const U={[Q.TYPE0]:S,[Q.TYPE1_CIRCLE]:I,[Q.TYPE1_SPHERE]:L,[Q.TYPE1_DISK]:R,[Q.TYPE2]:T,[G.COMB1]:class extends i{constructor(t){var e,i,s,n;super();const h=t.colors||y(1+Math.ceil(1e3*Math.random())%3),o=y(1)[0],a=new I({colors:h,position:t.position||{x:0,y:0},sizeFactor:null!==(e=t.sizeFactor)&&void 0!==e?e:.5,elementsFactor:null!==(i=t.elementsFactor)&&void 0!==i?i:.5});t.noSound||(a.sound=new w(g.EXPLOSION_FIZZ));const r=new T({colors:[o],position:t.position||{x:0,y:0},sizeFactor:null!==(s=t.sizeFactor)&&void 0!==s?s:.5,elementsFactor:null!==(n=t.elementsFactor)&&void 0!==n?n:.5});this.add(a),this.add(r,Math.round(10.5))}},[G.COMB2]:class extends i{constructor(t){var e,i,s;super();const n=t.colors||y(1+Math.ceil(1e3*Math.random())%2),o=r(null!==(e=t.sizeFactor)&&void 0!==e?e:.5,C.MIN_DISTANCE,C.MAX_DISTANCE),a=t.position||{x:0,y:0},l=new I({colors:n,position:a,sizeFactor:null!==(i=t.sizeFactor)&&void 0!==i?i:.5,elementsFactor:null!==(s=t.elementsFactor)&&void 0!==s?s:.5});this.add(l);const d=y(2);let c=Math.ceil(6);const u=o/2;for(let t=0;t<5;t++){const e=Math.random()*h,i=Math.random()*u,s=new S({colors:[d[t%2]],position:{x:a.x+Math.cos(e)*i,y:a.y+Math.sin(e)*i},sizeFactor:0,elementsFactor:0});this.add(s,c),c+=Math.ceil(3*Math.random())}}},[G.COMB3]:class extends i{constructor(t){var e,i,s,n;super();const h=t.colors||y(1+Math.ceil(1e3*Math.random())%3),o=t.colors||y(1+Math.ceil(1e3*Math.random())%2),a=new I({colors:h,position:t.position||{x:0,y:0},sizeFactor:null!==(e=t.sizeFactor)&&void 0!==e?e:.5,elementsFactor:null!==(i=t.elementsFactor)&&void 0!==i?i:.5});this.add(a);const r=new R({colors:o,position:t.position||{x:0,y:0},sizeFactor:null!==(s=t.sizeFactor)&&void 0!==s?s:.5,elementsFactor:null!==(n=t.elementsFactor)&&void 0!==n?n:.5});r.sound=null,this.add(r,2)}},[G.COMB4]:class extends i{constructor(t){var e;super();const i=t.colors||y(3),s=new S({colors:[i[0]],position:t.position||{x:0,y:0},sizeFactor:null!==(e=t.sizeFactor)&&void 0!==e?e:.5,elementsFactor:0});this.add(s);const n=r(t.sizeFactor,N.MIN_DISTANCE,N.MAX_DISTANCE)/2,o=t.position||{x:0,y:0};for(let e=0;e<i.length;e++){const s=Math.random()*h,a=Math.random()*n,r=new L({colors:[i[e]],position:{x:o.x+Math.cos(s)*a,y:o.y+Math.sin(s)*a},sizeFactor:t.sizeFactor,elementsFactor:t.elementsFactor});this.add(r,5+3*e)}}},[G.COMB5]:class extends i{constructor(t){var e,i,s;super();const n=t.colors||y(1+Math.ceil(1e3*Math.random())%3),h=new L({colors:n,position:t.position||{x:0,y:0},sizeFactor:null!==(e=t.sizeFactor)&&void 0!==e?e:.5,elementsFactor:null!==(i=t.elementsFactor)&&void 0!==i?i:.5});t.noSound||(h.sound=new w(g.EXPLOSION_FIZZ)),this.add(h);const o=new T({colors:["#ffffe7"],position:t.position||{x:0,y:0},sizeFactor:null!==(s=t.sizeFactor)&&void 0!==s?s:.5,elementsFactor:1});this.add(o,P)}},[G.COMB6]:class extends i{constructor(t){var e,i,s,n;super();const h=y(d(2,5)),o=new S({colors:[h[0]],position:t.position||{x:0,y:0},sizeFactor:null!==(e=t.sizeFactor)&&void 0!==e?e:.5,elementsFactor:null!==(i=t.elementsFactor)&&void 0!==i?i:.5});t.noSound||(o.sound=new w(g.EXPLOSION_2)),this.add(o);for(let e=0;e<h.length;e++){const i=new R({colors:[h[e]],position:t.position||{x:0,y:0},sizeFactor:(null!==(s=t.sizeFactor)&&void 0!==s?s:.5)*d(.6,1.2),elementsFactor:null!==(n=t.elementsFactor)&&void 0!==n?n:.5});i.sound=null,this.add(i,e)}}}},W={[q.TYPE0]:class extends X{constructor(t,e=null){var i,s;const n=r(null!==(i=t.sizeFactor)&&void 0!==i?i:.5,H.MIN_SIZE,H.MAX_SIZE);super(t,e,r(null!==(s=t.angleFactor)&&void 0!==s?s:.5,H.MIN_ANGLE,H.MAX_ANGLE),6*n,18*n),this.color=t.rocketColors&&t.rocketColors[0]||y(1,E)[0],t.noSound||(this.sound=new w(g.LAUNCH_1))}drawRocket(t){t.fillStyle=z,t.beginPath(),t.moveTo(-this.widthHalf,-this.height),t.lineTo(0,-this.height-this.width),t.lineTo(this.widthHalf,-this.height),t.lineTo(-this.widthHalf,-this.height),t.closePath(),t.fill(),t.fillStyle=this.color,t.strokeStyle="#404040",t.beginPath(),t.rect(-this.widthHalf,-this.height,this.width,this.height),t.closePath(),t.stroke(),t.fill(),t.fillStyle=z,t.fillRect(-this.widthHalf,-4,this.width,4),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillRect(-this.widthQuarter,-this.height,this.widthHalf,this.height),t.fillStyle="#999173",t.fillRect(-this.widthHalf,0,2,20)}drawWings(t){}},[q.TYPE1]:class extends X{constructor(t,e=null){var i,s;const n=r(null!==(i=t.sizeFactor)&&void 0!==i?i:.5,D.MIN_SIZE,D.MAX_SIZE);super(t,e,r(null!==(s=t.angleFactor)&&void 0!==s?s:.5,D.MIN_ANGLE,D.MAX_ANGLE),8*n,20*n),this.color1=t.rocketColors&&t.rocketColors[0]||y(1,E)[0],this.color2=t.rocketColors&&t.rocketColors[1]||y(1,E)[0],t.noSound||(this.sound=new w(g.LAUNCH_1))}drawRocket(t){t.fillStyle=this.color1,t.strokeStyle=O,t.beginPath(),t.moveTo(-this.widthHalf-this.widthQuarter,-this.height),t.lineTo(0,-this.height-this.width-this.widthQuarter),t.lineTo(this.widthHalf+this.widthQuarter,-this.height),t.lineTo(-this.widthHalf-this.widthQuarter,-this.height),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.rect(-this.widthHalf,-this.height,this.width,this.height),t.closePath(),t.fill(),t.fillStyle=this.color2,t.fillRect(-this.widthHalf,-this.height,this.width,this.heightQuarter),t.fillRect(-this.widthHalf,2*-this.heightQuarter,this.width,this.heightQuarter),t.fillStyle="#242424",t.fillRect(-this.widthHalf,-this.heightQuarter,this.width,this.heightQuarter),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillRect(-this.widthQuarter,-this.height,this.widthHalf,this.height),t.beginPath(),t.moveTo(-this.widthHalf+this.widthQuarter,-this.height),t.lineTo(0,-this.height-this.width-this.widthQuarter),t.lineTo(this.widthHalf-this.widthQuarter,-this.height),t.lineTo(-this.widthHalf+this.widthQuarter,-this.height),t.closePath(),t.fill(),t.fillStyle="#8c8468",t.fillRect(-this.widthHalf,0,2,25)}drawWings(t){t.fillStyle=this.color2,t.strokeStyle=O,t.beginPath(),t.moveTo(-this.width,this.heightQuarter),t.lineTo(-this.width,-this.heightQuarter),t.lineTo(-this.widthHalf,-this.heightHalf),t.lineTo(-this.widthHalf,this.heightQuarter),t.lineTo(-this.width,this.heightQuarter),t.fill(),t.stroke(),t.beginPath(),t.moveTo(this.width,this.heightQuarter),t.lineTo(this.width,-this.heightQuarter),t.lineTo(this.widthHalf,-this.heightHalf),t.lineTo(this.widthHalf,this.heightQuarter),t.lineTo(this.width,this.heightQuarter),t.fill(),t.stroke(),t.beginPath(),t.rect(-1,-this.heightHalf,2,this.heightHalf+this.heightQuarter),t.fill(),t.stroke()}}};class Z{createFirework(t,e){const i=[];let s;return Z.correctFireworkData(t),t.rocketType?(s=Z.createRocket(t,e),t.explosionType&&i.push(new Promise((e=>{s.finishCallback=i=>{e(Z.createExplosion({...t,position:i}))}})))):t.explosionType&&(s=Z.createExplosion(t)),s&&i.unshift(Promise.resolve(s)),i}getRandomFirework(t,e=!0){const i=[...Object.values(G)],s=[...Object.values(q)];return{explosionType:i[Math.floor(Math.random()*i.length)],rocketType:s[Math.floor(Math.random()*s.length)],sizeFactor:l(),elementsFactor:l(),angleFactor:l(),rocketFading:!0,canBeLaunched:!0,position:t,autoLaunch:e}}static createExplosion(t){const e=U[t.explosionType]||null;if(!e)throw new Error("Unknown type of explosion");return new e(t)}static createRocket(t,e){const i=W[t.rocketType]||null;if(!i)throw new Error("Unknown type of rocket");return new i(t,e)}static correctFireworkData(t){var e,i;void 0!==t.sizeFactor&&(t.sizeFactor=a(+t.sizeFactor)),void 0!==t.elementsFactor&&(t.elementsFactor=a(+t.elementsFactor)),void 0!==t.angleFactor&&(t.angleFactor=a(+t.angleFactor)),void 0===t.position||"number"==typeof(null===(e=t.position)||void 0===e?void 0:e.x)&&"number"==typeof(null===(i=t.position)||void 0===i?void 0:i.y)||delete t.position}}const K="rgba(11, 17, 34, 0.9)";window.customElements.define("fw-canvas",class extends t{constructor(){super(),this.updateCanvasSize=()=>{this.canvasFront&&(this.hasAttribute("fullscreen")?(this.canvasFront.width=window.innerWidth||document.documentElement.clientWidth,this.canvasFront.height=window.innerHeight||document.documentElement.clientHeight):(this.canvasFront.width=parseInt(this.getAttribute("width"),10)||200,this.canvasFront.height=parseInt(this.getAttribute("height"),10)||100),this.canvasBack.width=this.canvasFront.width,this.canvasBack.height=this.canvasFront.height,this.rendererBack.requestRender(),this.rendererFront.requestRender())},this.bgImageLoader=Promise.resolve(),this.fireworks=new WeakMap,this.elements=new WeakMap,this.deleteList=new WeakSet,this.builder=new Z}static get observedAttributes(){return["fullscreen","width","height","bg-color","bg-image","sounds-url"]}get canvas(){return this.canvasFront}async addFirework(t){let e=t.autoLaunch||!1;const i=this.builder.createFirework(t,this.canvasFront);for(const s of i){const i=await s;if(this.deleteList.has(t))return;this.fireworks.set(t,i),this.elements.set(i,t),e||!t.canBeLaunched?this.renderListFront.add(i,0,t.onBeforeRender||null,t.onAfterRender||null):this.renderListBack.add(i,0,t.onBeforeRender||null,t.onAfterRender||null),this.rendererBack.requestRender(),this.rendererFront.requestRender()}}getRandomFirework(t,e=!0){return this.builder.getRandomFirework(t,e)}removeFirework(t){if(this.deleteList.add(t),!this.fireworks.has(t))return;const e=this.fireworks.get(t);this.renderListFront.remove(e),this.renderListBack.remove(e),this.rendererBack.requestRender(),this.rendererFront.requestRender()}removeAllFireworks(){this.renderListBack.clear(),this.renderListFront.clear(),this.rendererBack.requestRender(),this.rendererFront.requestRender()}launchFirework(t){if(this.deleteList.has(t))return;if(!this.fireworks.has(t))return;if(!t.canBeLaunched)return;const e=this.fireworks.get(t);e instanceof X&&e.launch()}async render(){return new Promise((t=>{this.rendererFront.requestRender(t)}))}connectedCallback(){this.renderElement(),this.updateCanvasSize(),window.addEventListener("resize",this.updateCanvasSize),this.preloadSounds(),this.bgImageLoader.then((()=>{this.rendererBack.start(),this.rendererFront.start()}))}disconnectedCallback(){this.rendererBack.finish(),this.rendererFront.finish(),window.removeEventListener("resize",this.updateCanvasSize)}renderElement(){this.createShadowDom(":host([fullscreen]){position:relative;display:block}canvas{position:absolute}",'\n\t\t\t\t<canvas data-role="back"></canvas>\n\t\t\t\t<canvas data-role="front"></canvas>\n\t\t\t'),this.canvasFront=this.shadowRoot.querySelector('canvas[data-role="front"]'),this.renderListFront=new i,this.rendererFront=new e(this.renderListFront,this.canvasFront.getContext("2d")),this.rendererFront.useGlowTail(),this.canvasBack=this.shadowRoot.querySelector('canvas[data-role="back"]'),this.renderListBack=new i,this.rendererBack=new e(this.renderListBack,this.canvasBack.getContext("2d")),this.rendererBack.backgroundColor=this.getAttribute("bg-color")||K,this.rendererBack.observe(this.handleRender.bind(this)),this.canvasFront.addEventListener("click",this.handleClick.bind(this)),this.hasAttribute("bg-image")&&(this.bgImageLoader=this.rendererBack.setBackgroundImage(this.getAttribute("bg-image")||""))}handleRender(){this.dispatchEvent(new CustomEvent("render",{bubbles:!1,cancelable:!1,composed:!0}))}handleAttributesChange(){this.updateCanvasSize()}handleBgColorChange(){this.rendererBack&&(this.rendererBack.backgroundColor=this.getAttribute("bg-color")||K)}handleBgImageChange(){this.rendererBack&&(this.bgImageLoader=this.rendererBack.setBackgroundImage(this.getAttribute("bg-image")||""))}preloadSounds(){this.hasAttribute("sounds-url")&&(w.assetsUrl=this.getAttribute("sounds-url"));for(const t of Object.values(g))new w(t).preloadFile()}handleClick(t){const{left:e,top:i}=this.getBoundingClientRect(),s=t.clientX-e,n=t.clientY-i,h=this.renderListBack.getElementUnderPoint({x:s,y:n});if(!(h instanceof X&&this.elements.has(h)))return;const o=this.elements.get(h);o.canBeLaunched&&(this.dispatchEvent(new CustomEvent("launch",{composed:!0,bubbles:!1,cancelable:!1,detail:o})),this.renderListFront.add(h,0,o.onBeforeRender||null,o.onAfterRender||null),this.rendererFront.requestRender((()=>{this.rendererBack.requestRender(),this.renderListBack.remove(h),h.launch()})))}})})();